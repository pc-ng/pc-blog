
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Blog about life, when life is about research." name="description"/>
<meta content="Research" name="keywords"/>
<meta content="Pc Ng" name="author"/>
<link href="https://pc-ng.github.io/biometric_signals/aboutecg/aboutecg/" rel="canonical"/>
<!-- <link rel="icon" href="../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.2"> -->
<title>Heart Rate Measurement from ECG - Pc's Blog</title>
<link href="../../../assets/stylesheets/main.6f955dcd.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.ef6f36e2.min.css" rel="stylesheet"/>
<meta content="#4cae4f" name="theme-color"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Noto+Serif:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Noto Serif";--md-code-font-family:"Roboto Mono"}</style>
<link href="../../../assets/extra.css" rel="stylesheet"/>
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-129545199-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script async="" data-ad-client="ca-pub-9658356171910088" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script async="" crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9658356171910088"></script>
<meta content="website" property="og:type"/>
<meta content="Pc's Blog - Heart Rate Measurement from ECG" property="og:title"/>
<meta content="Blog about life, when life is about research." property="og:description"/>
<meta content="https://pc-ng.github.io/biometric_signals/aboutecg/aboutecg/" property="og:url"/>
<meta content="https://pc-ng.github.io/assets/banner.jpg" property="og:image"/>
<meta content="image/png" property="og:image:type"/>
<meta content="1080" property="og:image:width"/>
<meta content="568" property="og:image:height"/>
<script async="" data-ad-client="ca-pub-9658356171910088" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script async="" crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9658356171910088"></script>
</head>
<body data-md-color-accent="" data-md-color-primary="green" data-md-color-scheme="" dir="ltr">
<script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#electrocardiogram-ecg">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Pc's Blog" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="Pc's Blog">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M296 464h-56V338.78l168.74-168.73c15.52-15.52 4.53-42.05-17.42-42.05H24.68c-21.95 0-32.94 26.53-17.42 42.05L176 338.78V464h-56c-22.09 0-40 17.91-40 40 0 4.42 3.58 8 8 8h240c4.42 0 8-3.58 8-8 0-22.09-17.91-40-40-40zM432 0c-62.61 0-115.35 40.2-135.18 96h52.54c16.65-28.55 47.27-48 82.64-48 52.93 0 96 43.06 96 96s-43.07 96-96 96c-14.04 0-27.29-3.2-39.32-8.64l-35.26 35.26C379.23 279.92 404.59 288 432 288c79.53 0 144-64.47 144-144S511.53 0 432 0z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Pc's Blog
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Heart Rate Measurement from ECG
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
      Home
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../artificial_intelligence/">
        Artificial intelligence
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../../aboutheartrate/aboutheartrate/">
        Biometric signals
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../blog/research/">
        Blog
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../bluetooth/bluetooth/">
        Bluetooth
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../programming/matlab/">
        Programming
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../tags/">
      Tags
    </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Pc's Blog" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="Pc's Blog">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M296 464h-56V338.78l168.74-168.73c15.52-15.52 4.53-42.05-17.42-42.05H24.68c-21.95 0-32.94 26.53-17.42 42.05L176 338.78V464h-56c-22.09 0-40 17.91-40 40 0 4.42 3.58 8 8 8h240c4.42 0 8-3.58 8-8 0-22.09-17.91-40-40-40zM432 0c-62.61 0-115.35 40.2-135.18 96h52.54c16.65-28.55 47.27-48 82.64-48 52.93 0 96 43.06 96 96s-43.07 96-96 96c-14.04 0-27.29-3.2-39.32-8.64l-35.26 35.26C379.23 279.92 404.59 288 432 288c79.53 0 144-64.47 144-144S511.53 0 432 0z"></path></svg>
</a>
    Pc's Blog
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
        Artificial intelligence
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Artificial intelligence" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Artificial intelligence
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../artificial_intelligence/">
        Deep Learning
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../artificial_intelligence/computer_vision/face_detection_opencv/face_detection_opencv/">
        Face Detection with OpenCV
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../artificial_intelligence/timeseries/dtw/">
        Dynamic Time Warping
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
        Biometric signals
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Biometric signals" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Biometric signals
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../aboutheartrate/aboutheartrate/">
        Heart Rate
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Heart Rate Measurement from ECG
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Heart Rate Measurement from ECG
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#electrocardiogram-ecg">
    Electrocardiogram (ECG)
  </a>
<nav aria-label="Electrocardiogram (ECG)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ecg-morphology">
    ECG Morphology
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#determine-the-heart-rate-from-ecg">
    Determine the heart rate from ECG
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#r-peak-detection">
    R-peak Detection
  </a>
<nav aria-label="R-peak Detection" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#step-1-moving-average">
    Step 1: Moving average
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-2-rois-identification">
    Step 2: RoIs Identification
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-3-peak-detection">
    Step 3: Peak Detection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-4-peak-validation">
    Step 4: Peak Validation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-5-heart-rate-computation">
    Step 5: Heart Rate Computation
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#wrap-up-the-r-peak-detection">
    Wrap Up the R-peak Detection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#resources">
    Resources
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
        Blog
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Blog" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Blog
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/research/">
        Research
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2">
        Tools
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Tools" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          Tools
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/tools/diplaying-image-with-opencv-inside-jupyterlab/Displaying-Image-with-OpenCV-inside-JupyterLab/">
        Displaying an Image with OpenCV inside Jupyter Lab
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/tools/jupyter_lab_virtual_env/2021-05-13-jupyterLabVirtualEnv/">
        Adding Virtual Environment to Jupyter Lab
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
        Bluetooth
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Bluetooth" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Bluetooth
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../bluetooth/bluetooth/">
        About Bluetooth
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../bluetooth/contact_tracing/2021-04-15-contactTracing/">
        Smart Contact Tracing Project at University of Guelph
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
        Programming
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Programming" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Programming
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../programming/matlab/">
        Matlab
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" id="__nav_6_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_2">
        Python
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Python" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_2">
<span class="md-nav__icon md-icon"></span>
          Python
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../programming/python/2021-04-18-flattenRavel/">
        Flatten vs Ravel functions in Numpy
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../programming/python/histogramVis/">
        Visualize Data Distribution with Histogram
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tags/">
        Tags
      </a>
</li>
</ul>
</nav>
<div class="tag-cloud-nav">
<br/>
<br/>
<br/>
<div style="font-weight:700; font-size:.7rem; margin:0 0.6rem;">
<label>Tag cloud</label>
</div>
<div style="padding: 0.4rem 0.6rem;">
<div class="tag-cloud">
<a class="tag" href="https://pc-ng.github.io/tags/#Seaborn">
<span class="tag-name" style="font-size:1.0rem;color:DarkSlateBlue;">Seaborn
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Python">
<span class="tag-name" style="font-size:1.5rem;color:DarkOliveGreen;">Python
            </span>
<sup class="tag-count">2</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Bluetooth">
<span class="tag-name" style="font-size:1.0rem;color:DarkOrchid;">Bluetooth
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#contact tracing">
<span class="tag-name" style="font-size:1.0rem;color:DarkViolet;">contact tracing
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#research">
<span class="tag-name" style="font-size:1.0rem;color:DarkGoldenrod;">research
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Matplotlib">
<span class="tag-name" style="font-size:1.0rem;color:DarkRed;">Matplotlib
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#JupyterLab">
<span class="tag-name" style="font-size:1.5rem;color:DarkSlateGray;">JupyterLab
            </span>
<sup class="tag-count">2</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#OpenCV">
<span class="tag-name" style="font-size:1.5rem;color:DarkOrange;">OpenCV
            </span>
<sup class="tag-count">2</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#PPG">
<span class="tag-name" style="font-size:1.0rem;color:DarkOliveGreen;">PPG
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#HR">
<span class="tag-name" style="font-size:1.5rem;color:DarkMagenta;">HR
            </span>
<sup class="tag-count">2</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Algorithm">
<span class="tag-name" style="font-size:1.0rem;color:DarkTurquoise;">Algorithm
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#BLE">
<span class="tag-name" style="font-size:1.0rem;color:DarkMagenta;">BLE
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#HRV">
<span class="tag-name" style="font-size:1.5rem;color:DarkOliveGreen;">HRV
            </span>
<sup class="tag-count">2</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Numpy">
<span class="tag-name" style="font-size:1.0rem;color:DarkRed;">Numpy
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Matlab">
<span class="tag-name" style="font-size:1.0rem;color:DarkCyan;">Matlab
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Virtual Environment">
<span class="tag-name" style="font-size:1.0rem;color:DarkOrange;">Virtual Environment
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Face Detection">
<span class="tag-name" style="font-size:1.0rem;color:DarkOliveGreen;">Face Detection
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#ECG">
<span class="tag-name" style="font-size:1.5rem;color:DarkGoldenrod;">ECG
            </span>
<sup class="tag-count">2</sup>
</a>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#electrocardiogram-ecg">
    Electrocardiogram (ECG)
  </a>
<nav aria-label="Electrocardiogram (ECG)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ecg-morphology">
    ECG Morphology
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#determine-the-heart-rate-from-ecg">
    Determine the heart rate from ECG
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#r-peak-detection">
    R-peak Detection
  </a>
<nav aria-label="R-peak Detection" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#step-1-moving-average">
    Step 1: Moving average
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-2-rois-identification">
    Step 2: RoIs Identification
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-3-peak-detection">
    Step 3: Peak Detection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-4-peak-validation">
    Step 4: Peak Validation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-5-heart-rate-computation">
    Step 5: Heart Rate Computation
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#wrap-up-the-r-peak-detection">
    Wrap Up the R-peak Detection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#resources">
    Resources
  </a>
</li>
</ul>
</nav>
<div class="tag-cloud-toc">
<br/>
<br/>
<br/>
<div style="font-weight:700; font-size:.7rem; margin:0 0.6rem;">
<label>Tag cloud</label>
</div>
<div style="padding: 0.4rem 0.6rem;">
<div class="tag-cloud">
<a class="tag" href="https://pc-ng.github.io/tags/#Numpy">
<span class="tag-name" style="font-size:1.0rem;color:DarkMagenta;">Numpy
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Matlab">
<span class="tag-name" style="font-size:1.0rem;color:DarkOrchid;">Matlab
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Matplotlib">
<span class="tag-name" style="font-size:1.0rem;color:DarkMagenta;">Matplotlib
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#research">
<span class="tag-name" style="font-size:1.0rem;color:DarkGoldenrod;">research
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Seaborn">
<span class="tag-name" style="font-size:1.0rem;color:DarkOliveGreen;">Seaborn
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#BLE">
<span class="tag-name" style="font-size:1.0rem;color:DarkCyan;">BLE
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#OpenCV">
<span class="tag-name" style="font-size:1.5rem;color:DarkViolet;">OpenCV
            </span>
<sup class="tag-count">2</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#PPG">
<span class="tag-name" style="font-size:1.0rem;color:DarkViolet;">PPG
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Bluetooth">
<span class="tag-name" style="font-size:1.0rem;color:DarkOliveGreen;">Bluetooth
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#HRV">
<span class="tag-name" style="font-size:1.5rem;color:DarkTurquoise;">HRV
            </span>
<sup class="tag-count">2</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Face Detection">
<span class="tag-name" style="font-size:1.0rem;color:DarkSlateGray;">Face Detection
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#contact tracing">
<span class="tag-name" style="font-size:1.0rem;color:DarkOliveGreen;">contact tracing
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#ECG">
<span class="tag-name" style="font-size:1.5rem;color:DarkGoldenrod;">ECG
            </span>
<sup class="tag-count">2</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Algorithm">
<span class="tag-name" style="font-size:1.0rem;color:DarkRed;">Algorithm
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Virtual Environment">
<span class="tag-name" style="font-size:1.0rem;color:DarkRed;">Virtual Environment
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#Python">
<span class="tag-name" style="font-size:1.5rem;color:DarkMagenta;">Python
            </span>
<sup class="tag-count">2</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#JupyterLab">
<span class="tag-name" style="font-size:1.5rem;color:DarkViolet;">JupyterLab
            </span>
<sup class="tag-count">2</sup>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#HR">
<span class="tag-name" style="font-size:1.5rem;color:DarkOliveGreen;">HR
            </span>
<sup class="tag-count">2</sup>
</a>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<div class="page-cover">
<h1 class="page-title">Heart Rate Measurement from ECG</h1>
<p class="md-source-date">
<hr class="print-only"/>
<small>
                        Date: 2021-05-24 16:30:23,  by Pc Ng
                    </small>
</p>
<p>
<a class="tag" href="https://pc-ng.github.io/tags/#HR">
<span class="tag-name" style="color:DarkGreen;">
                        #HR
                    </span>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#ECG">
<span class="tag-name" style="color:DarkGreen;">
                        #ECG
                    </span>
</a>
<a class="tag" href="https://pc-ng.github.io/tags/#HRV">
<span class="tag-name" style="color:DarkSlateBlue;">
                        #HRV
                    </span>
</a>
</p>
</div>
<div class="toc print-only">
<h2>Table of Content</h2>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#electrocardiogram-ecg">
    Electrocardiogram (ECG)
  </a>
<nav aria-label="Electrocardiogram (ECG)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ecg-morphology">
    ECG Morphology
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#determine-the-heart-rate-from-ecg">
    Determine the heart rate from ECG
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#r-peak-detection">
    R-peak Detection
  </a>
<nav aria-label="R-peak Detection" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#step-1-moving-average">
    Step 1: Moving average
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-2-rois-identification">
    Step 2: RoIs Identification
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-3-peak-detection">
    Step 3: Peak Detection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-4-peak-validation">
    Step 4: Peak Validation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-5-heart-rate-computation">
    Step 5: Heart Rate Computation
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#wrap-up-the-r-peak-detection">
    Wrap Up the R-peak Detection
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#resources">
    Resources
  </a>
</li>
</ul>
</nav>
</div>
<h2 id="electrocardiogram-ecg">Electrocardiogram (ECG)<a class="headerlink" href="#electrocardiogram-ecg" title="Permanent link">⚓︎</a></h2>
<p>Electrocardiogram (ECG) measures the electrical activity in our heart. ECG machine is commonly used in hospital to monitor patient's heart rate. Nowadays, a few consumer-grade device has integrated the ECG sensor into their smartwatch, for example <a href="https://www.apple.com/ca/healthcare/apple-watch/">Apple Watch</a> and <a href="https://www.fitbit.com/global/us/technology/ecg">Fitbit</a>.</p>
<p><img src="../ecgwatch.jpg" style="display: block; margin-left: auto; margin-right: auto; width: 1100px;"/></p>
<h3 id="ecg-morphology">ECG Morphology<a class="headerlink" href="#ecg-morphology" title="Permanent link">⚓︎</a></h3>
<p>ECG morphology can be described by 5 waves: P-wave, Q-wave, R-wave, S-wave, and T-wave.</p>
<ul>
<li>P-wave reflects atrial depolarization. It is a small wave due to the small muscle mass made by atria.</li>
<li>T-wave reflects the rapid repolarization of contractile cell. Normal T-wave is slightly asymmetric, with a steeper downward slope.</li>
<li>Q-wave, R-wave, S-wave are knowns as QRS complex in general. The QRS complex represents the depolarization of the ventricles. A QRS complex with a short duration implies a rapid depolarization, proving that the conduction system functions properly. A QRS complex with a long duration implies a slow depolarization, showing a high likelihood the dysfunction in conduction system.</li>
</ul>
<p><img src="../qrs.jpg" style="display: block; margin-left: auto; margin-right: auto; width: 500px;"/></p>
<h3 id="determine-the-heart-rate-from-ecg">Determine the heart rate from ECG<a class="headerlink" href="#determine-the-heart-rate-from-ecg" title="Permanent link">⚓︎</a></h3>
<p>The heart rate can be determined by measuring the duration of RR interval between two successive QRS complexes. 
Once the RR interval is known, the heart rate can be computed as follows:</p>
<div class="arithmatex">\[
HR = 60 \frac{1}{d_{RR}}
\]</div>
<p>where HR is heart rate is bpm, and <span class="arithmatex">\(d_{RR}\)</span> is the duration of RR interval.</p>
<p><img src="../rpeak.jpg" style="display: block; margin-left: auto; margin-right: auto; width: 550px;"/></p>
<p>Hence, the first problem to heart rate estimation is to locate the position of R-peak. </p>
<h2 id="r-peak-detection">R-peak Detection<a class="headerlink" href="#r-peak-detection" title="Permanent link">⚓︎</a></h2>
<p>We will use a sample <a href="https://github.com/pc-ng/Physiological-Demo/blob/master/ECG-HR/sample-ecg-data-70.csv">ECG data</a> to demonstrate the R-peak detection, estimating the RR interval, and calculating the heart rate.<br/>
This sample ECG data is generated artificially using <a href="https://neurokit2.readthedocs.io/en/latest/introduction.html">neurokit2</a>. A 5 second data is generated with 100Hz sampling rate.</p>
<p>The data is saved in csv file so we can use pandas to read the data. We can visualize the sample data using matplotlib.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 

<span class="n">fs</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'sample-ecg-data-70.csv'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">ECG</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Time (s)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'ECG Amplitude'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Output:</p>
<p>
<figure><img src="../aboutecg_3_0.svg"><figcaption>.</figcaption>
</img></figure>
</p>
</div>
<p>From the plot, we can clearly identify the P-wave, T-wave, and the QRS complex.
The goal is to locate all the R-peaks given the 5 second ECG signal.
There are a number of ways to R-peaks detection, one of them is described in <a href="https://ieeexplore.ieee.org/document/1166717">Halmiton algorithm</a></p>
<p>Here, we will use a simple moving average approach to R-peak detection. The key steps of this approach is summarized as follows:</p>
<ul>
<li>compute the moving average with a window that is at least half the sampling frequency</li>
<li>mark the region of interest (RoI) for those signals above the moving average</li>
<li>locate the peak value and peak location for all RoIs</li>
<li>calculate the average peak value of all peaks, and reject those peaks with peak value less than the average</li>
<li>compute the duration between each RR-interval, and use the mean duration to compute the heart rate.</li>
</ul>
<h3 id="step-1-moving-average">Step 1: Moving average<a class="headerlink" href="#step-1-moving-average" title="Permanent link">⚓︎</a></h3>
<p>The sampling rate is 100Hz, so half the sampling rate is 50Hz, which means 50 data points per one second.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. compute the moving average with window of 50 data points</span>
<span class="n">window</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># use the convolve function by numpy to compute the moving average</span>
<span class="n">data</span><span class="p">[</span><span class="s1">'ECG_ma'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ECG</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="s1">'same'</span><span class="p">)</span> <span class="o">/</span><span class="n">window</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">ECG</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'raw ECG data'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">ECG_ma</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'moving average'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Time (s)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'ECG Amplitude'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Output:</p>
<p>
<figure><img src="../aboutecg_7_0.svg"><figcaption>.</figcaption>
</img></figure>
</p>
</div>
<h3 id="step-2-rois-identification">Step 2: RoIs Identification<a class="headerlink" href="#step-2-rois-identification" title="Permanent link">⚓︎</a></h3>
<p>From the above plot, we can see that some data points are above the moving average line, and some are below. 
We can mark those above the moving average line as RoI.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 2. find all the RoIs</span>
<span class="n">data</span><span class="p">[</span><span class="s1">'roi'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="n">track_start</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># check if the point is above the moving average point</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">ECG</span> <span class="o">&gt;</span> <span class="n">row</span><span class="o">.</span><span class="n">ECG_ma</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">track_start</span><span class="p">):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">roi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'[</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">] RoI detected...'</span><span class="p">)</span>
            <span class="n">track_start</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">data</span><span class="o">.</span><span class="n">roi</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">track_start</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Output:</p>
<div class="highlight"><pre><span></span><code>[1] RoI detected...
[2] RoI detected...
[3] RoI detected...
[4] RoI detected...
[5] RoI detected...
[6] RoI detected...
[7] RoI detected...
[8] RoI detected...
[9] RoI detected...
[10] RoI detected...
[11] RoI detected...
[12] RoI detected...
[13] RoI detected...
[14] RoI detected...
[15] RoI detected...
[16] RoI detected...
[17] RoI detected...
[18] RoI detected...
</code></pre></div>
</div>
<h3 id="step-3-peak-detection">Step 3: Peak Detection<a class="headerlink" href="#step-3-peak-detection" title="Permanent link">⚓︎</a></h3>
<p>For each RoI, we can compute the peak value and peak position by taking the maximum value.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 3. locate the peak for all RoIs</span>
<span class="n">groups</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'roi'</span><span class="p">])</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'roi'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">,</span> <span class="s1">'position'</span><span class="p">]</span>
<span class="n">peak</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,(</span><span class="n">roi</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">roi</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">peak</span> <span class="o">=</span> <span class="n">peak</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span>
                                <span class="s1">'roi'</span><span class="p">:</span> <span class="n">roi</span><span class="p">,</span>
                                <span class="s1">'value'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">ECG</span><span class="p">),</span>
                                <span class="s1">'position'</span><span class="p">:</span> <span class="n">group</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">ECG</span><span class="p">)]</span>
                            <span class="p">},</span> <span class="n">name</span> <span class="o">=</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">ECG</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'raw ECG data'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">ECG_ma</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'moving average'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">peak</span><span class="o">.</span><span class="n">position</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">),</span> <span class="n">peak</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'x'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"R-peak"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Time (s)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'ECG Amplitude'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Output:</p>
<p>
<figure><img src="../aboutecg_12_0.svg"><figcaption>.</figcaption>
</img></figure>
</p>
</div>
<h3 id="step-4-peak-validation">Step 4: Peak Validation<a class="headerlink" href="#step-4-peak-validation" title="Permanent link">⚓︎</a></h3>
<p>From the above plot, it shows that the peak of QRS complex is detected, as well as the peak from T-wave and P-wave. However, we just want to keep the peak from the QRS complex. We can validate the peak to see if the peak is the one we would like to keep or to reject. The simplest way is to compare each peak value with the average peak value and then keep only those peaks with value greater than the average peak value.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># compute the average peak values</span>
<span class="n">average_peak_value</span> <span class="o">=</span> <span class="n">peak</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># keep only the peaks that are greater than the average peak value</span>
<span class="n">val_peak</span> <span class="o">=</span> <span class="n">peak</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">peak</span><span class="o">.</span><span class="n">value</span><span class="o">&gt;</span><span class="n">average_peak_value</span><span class="p">,</span> <span class="p">:]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">ECG</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'raw ECG data'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">ECG_ma</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'moving average'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">val_peak</span><span class="o">.</span><span class="n">position</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">),</span> <span class="n">val_peak</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'x'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Validated R-peak"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Time (s)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'ECG Amplitude'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Output:</p>
<p>
<figure><img src="../aboutecg_15_0.svg"/><figcaption>.</figcaption>
</figure>
</p>
</div>
<h3 id="step-5-heart-rate-computation">Step 5: Heart Rate Computation<a class="headerlink" href="#step-5-heart-rate-computation" title="Permanent link">⚓︎</a></h3>
<p>First, compute the duration between each RR interval, and then use the duration to compute for the heart rate, i.e., </p>
<div class="arithmatex">\[
HR = 60 \frac{1}{d_{RR}}, \qquad (bpm)
\]</div>
<div class="highlight"><pre><span></span><code><span class="n">RR_duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">val_peak</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">val_peak</span><span class="o">.</span><span class="n">position</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span>
<span class="n">HR</span> <span class="o">=</span> <span class="mi">60</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RR_duration</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Heart rate: </span><span class="si">{</span><span class="n">HR</span><span class="si">}</span><span class="s1"> bpm'</span><span class="p">)</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Output:</p>
<p>Heart rate: 70.09345794392523 bpm</p>
</div>
<h2 id="wrap-up-the-r-peak-detection">Wrap Up the R-peak Detection<a class="headerlink" href="#wrap-up-the-r-peak-detection" title="Permanent link">⚓︎</a></h2>
<p>We can group those five steps into a single function that accepts the ECG data and sampling rate as input argument and return a list of tuple containing R-peak values and their corresponding positions. The benefit of using function is that we can reuse the function for different ECG data without rewriting the same code. Let's realize this function implementation for R-peak detection.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">moving_average</span><span class="p">(</span><span class="n">ecg</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ecg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="s1">'same'</span><span class="p">)</span> <span class="o">/</span><span class="n">window</span>

<span class="k">def</span> <span class="nf">rpeak_detection</span><span class="p">(</span><span class="n">ecg</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ecg</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'ECG'</span><span class="p">])</span>

    <span class="c1"># 1. moving average</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">'ECG_ma'</span><span class="p">]</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ECG</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">fs</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># 2. find all the RoIs</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">'roi'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="n">track_start</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="c1"># check if the point is above the moving average point</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">ECG</span> <span class="o">&gt;</span> <span class="n">row</span><span class="o">.</span><span class="n">ECG_ma</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">track_start</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">roi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">track_start</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">data</span><span class="o">.</span><span class="n">roi</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">track_start</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># 3. locate the peak for all RoIs</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'roi'</span><span class="p">])</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'roi'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">,</span> <span class="s1">'position'</span><span class="p">]</span>
    <span class="n">peak</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,(</span><span class="n">roi</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">roi</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">peak</span> <span class="o">=</span> <span class="n">peak</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span>
                                    <span class="s1">'roi'</span><span class="p">:</span> <span class="n">roi</span><span class="p">,</span>
                                    <span class="s1">'value'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">ECG</span><span class="p">),</span>
                                    <span class="s1">'position'</span><span class="p">:</span> <span class="n">group</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">ECG</span><span class="p">)]</span>
                                <span class="p">},</span> <span class="n">name</span> <span class="o">=</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># 4. validate the peak</span>
    <span class="n">average_peak_value</span> <span class="o">=</span> <span class="n">peak</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">val_peak</span> <span class="o">=</span> <span class="n">peak</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">peak</span><span class="o">.</span><span class="n">value</span><span class="o">&gt;</span><span class="n">average_peak_value</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">val_peak</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">val_peak</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>
<p>Create a function to compute the heart rate given the list of R-peak positions as input argument.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cal_HR</span><span class="p">(</span><span class="n">rpeak_position</span><span class="p">):</span>
    <span class="n">RR_duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">rpeak_position</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">rpeak_position</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span>
    <span class="k">return</span> <span class="mi">60</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RR_duration</span><span class="p">)</span>
</code></pre></div>
<p>Create a plotting function to visualize the detected R-peaks with respect to the ECG data.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">plot_rpeak</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">ecg</span><span class="p">,</span> <span class="n">peak_position</span><span class="p">,</span> <span class="n">peak_value</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ecg</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">),</span> <span class="n">ecg</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'raw ECG data'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">peak_position</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">),</span> <span class="n">peak_value</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'x'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Validated R-peak"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Time (s)'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'ECG Amplitude'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p>We can now call the function by supplying the ECG data and the sampling rate. Besides trying with the ECG data we have previously, we can also try with another two ECG samples: <a href="https://github.com/pc-ng/Physiological-Demo/blob/master/ECG-HR/sample-ecg-data-75.csv">sample-ecg-data-75</a>, <a href="https://github.com/pc-ng/Physiological-Demo/blob/master/ECG-HR/sample-ecg-data-85.csv">sample-ecg-data-85</a>.
Both samples are of 5 second duration with sampling rate equals to 100Hz. Note that the <code>rpeak_detection</code> function takes in a numpy array as input argument, so we got to be careful when supplying the ecg input to the function.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># try with sample-ecg-data-70</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'sample-ecg-data-70.csv'</span><span class="p">)</span>
<span class="n">rpeaks</span> <span class="o">=</span> <span class="n">rpeak_detection</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ECG</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plot_rpeak</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ECG</span><span class="p">,</span> <span class="n">rpeaks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rpeaks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># compute the heart rate</span>
<span class="n">HR</span> <span class="o">=</span> <span class="n">cal_HR</span><span class="p">(</span><span class="n">rpeaks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Heart rate: </span><span class="si">{</span><span class="n">HR</span><span class="si">}</span><span class="s1"> bpm'</span><span class="p">)</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Output:</p>
<p>
<figure><img src="../aboutecg_27_0.svg"/><figcaption>.</figcaption>
</figure>
</p>
</div>
<div class="admonition note">
<p class="admonition-title">Output:</p>
<p>Heart rate: 70.09345794392523 bpm</p>
</div>
<div class="highlight"><pre><span></span><code><span class="c1"># try with sample-ecg-data-75</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'sample-ecg-data-75.csv'</span><span class="p">)</span>

<span class="n">rpeaks</span> <span class="o">=</span> <span class="n">rpeak_detection</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ECG</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plot_rpeak</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ECG</span><span class="p">,</span> <span class="n">rpeaks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rpeaks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># compute the heart rate</span>
<span class="n">HR</span> <span class="o">=</span> <span class="n">cal_HR</span><span class="p">(</span><span class="n">rpeaks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Heart rate: </span><span class="si">{</span><span class="n">HR</span><span class="si">}</span><span class="s1"> bpm'</span><span class="p">)</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Output:</p>
<p>
<figure><img src="../aboutecg_28_0.svg"/><figcaption>.</figcaption>
</figure>
</p>
</div>
<div class="admonition note">
<p class="admonition-title">Output:</p>
<p>Heart rate: 75.0 bpm</p>
</div>
<div class="highlight"><pre><span></span><code><span class="c1"># try with sample-ecg-data-85</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'sample-ecg-data-85.csv'</span><span class="p">)</span>

<span class="n">rpeaks</span> <span class="o">=</span> <span class="n">rpeak_detection</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ECG</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plot_rpeak</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ECG</span><span class="p">,</span> <span class="n">rpeaks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rpeaks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># compute the heart rate</span>
<span class="n">HR</span> <span class="o">=</span> <span class="n">cal_HR</span><span class="p">(</span><span class="n">rpeaks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Heart rate: </span><span class="si">{</span><span class="n">HR</span><span class="si">}</span><span class="s1"> bpm'</span><span class="p">)</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Output:</p>
<p>
<figure><img src="../aboutecg_29_0.svg"/><figcaption>.</figcaption>
</figure>
</p>
</div>
<div class="admonition note">
<p class="admonition-title">Output:</p>
<p>Heart rate: 85.02024291497976 bpm</p>
</div>
<h2 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">⚓︎</a></h2>
<p>The complete code to the above implementation is available <a href="https://github.com/pc-ng/Physiological-Demo/blob/master/ECG-HR/aboutecg.ipynb">here</a>.
Many algorithms have been developed to compute the R-peak detection. <a href="https://github.com/berndporr/py-ecg-detectors">Here</a> you can find a collection of 7 ECG heartbeat detection algorithms implemented in Python. You can try out those peak detection algorithms by installing the package using <code>pip install py-ecg-detectors</code>.</p>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" data-md-state="hidden" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path></svg>
</a>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a class="md-footer__link md-footer__link--prev" href="../../aboutheartrate/aboutheartrate/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              Heart Rate
            </div>
</div>
</a>
<a class="md-footer__link md-footer__link--next" href="../../../blog/research/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Research
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            Perfectly Imperfect <div style="display:none"><div>
</div>
</div>
<div style="color: var(--md-footer-fg-color--lighter);">
        Pc Ng © <script>document.write(new Date().getFullYear())</script>.  All rights reserved.
    </div>
</div>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://github.com/pc-ng" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 480 512" xmlns="http://www.w3.org/2000/svg"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://www.linkedin.com/in/pc-ng-3b45072b" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.top", "header.autohide"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
<script src="../../../assets/javascripts/bundle.4ea5477f.min.js"></script>
<script src="../../../assets/extra.js"></script>
<script src="../../../assets/config.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>